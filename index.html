<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Manager App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        .page-section { display: none; }
        .page-section.active { display: block; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-blue-600">‚öΩ Tournament Hub</h1>
            <nav class="space-x-4">
                <button class="nav-button active p-2 rounded-md text-gray-700 hover:bg-blue-100 transition duration-150" data-target="home">Home</button>
                <button class="nav-button p-2 rounded-md text-gray-700 hover:bg-blue-100 transition duration-150" data-target="teams">Teams</button>
                <button class="nav-button p-2 rounded-md text-gray-700 hover:bg-blue-100 transition duration-150" data-target="matches">Matches</button>
                <button class="nav-button p-2 rounded-md text-gray-700 hover:bg-blue-100 transition duration-150" data-target="standings">Standings</button>
                <button id="admin-link" class="nav-button p-2 rounded-md text-red-600 hover:bg-red-100 transition duration-150" data-target="admin" style="display:none;">Admin</button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <section id="home" class="page-section active">
            <h2 class="text-4xl font-bold text-gray-800 mb-6 border-b pb-2">Welcome to the Tournament</h2>
            <div class="bg-white p-6 rounded-xl card-shadow">
                <p class="text-lg text-gray-600">This platform provides real-time updates on team standings and match results.</p>
                <p class="mt-4 text-gray-700">Navigate using the buttons above to view the tournament details.</p>
            </div>
        </section>

        <section id="teams" class="page-section">
            <h2 class="text-4xl font-bold text-gray-800 mb-6 border-b pb-2">Registered Teams</h2>
            <div id="teams-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                </div>
        </section>

        <section id="matches" class="page-section">
            <h2 class="text-4xl font-bold text-gray-800 mb-6 border-b pb-2">Match Schedule & Results</h2>
            
            <h3 id="upcoming-matches-heading" class="text-3xl font-semibold text-blue-700 mb-4 mt-6">Upcoming Matches</h3>
            <div id="upcoming-matches" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
            
            <h3 class="text-3xl font-semibold text-red-700 mb-4 mt-6">Past Results</h3>
            <div id="past-matches" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </section>

        <section id="standings" class="page-section">
            <h2 class="text-4xl font-bold text-gray-800 mb-6 border-b pb-2">League Standings</h2>
            <div class="overflow-x-auto bg-white rounded-xl card-shadow">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-blue-50">
                        <tr>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">P</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">W</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">D</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">L</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GF</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GA</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GD</th>
                            <th scope="col" class="px-1 py-3 sm:px-6 sm:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pts</th>
                        </tr>
                    </thead>
                    <tbody id="standings-table-body" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="admin" class="page-section">
            <h2 class="text-4xl font-bold text-gray-800 mb-6 border-b pb-2">Admin Panel üîë</h2>
            
            <div id="admin-password-prompt" class="bg-red-50 p-6 rounded-xl card-shadow max-w-md mx-auto">
                <h3 class="text-xl font-semibold text-red-700 mb-4">Admin Login Required</h3>
                <div class="mb-4">
                    <label for="admin-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="admin-email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                <div class="mb-4">
                    <label for="admin-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="admin-password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                <p id="admin-password-error" class="text-red-500 text-sm mb-4 hidden"></p>
                <button id="admin-login-button" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none">Login</button>
            </div>

            <div id="admin-content" style="display: none;">
                <button id="admin-logout-button" class="mb-4 py-2 px-4 rounded-md text-white bg-gray-500 hover:bg-gray-600">Logout</button>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl card-shadow border border-blue-200">
                        <h3 class="text-2xl font-semibold text-blue-700 mb-4">Update Match Result</h3>
                        <form id="update-score-form">
                            <div class="mb-4">
                                <label for="match-select" class="block text-sm font-medium text-gray-700">Select Match</label>
                                <select id="match-select" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                    <option value="">-- Select a Match --</option>
                                </select>
                            </div>

                            <div id="date-time-inputs" class="grid grid-cols-2 gap-4 mb-4" style="display: none;">
                                <div>
                                    <label for="match-date" class="block text-sm font-medium text-gray-700">Date</label>
                                    <input type="date" id="match-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                </div>
                                <div>
                                    <label for="match-time" class="block text-sm font-medium text-gray-700">Time (24h)</label>
                                    <input type="time" id="match-time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label id="score1-label" for="score1" class="block text-sm font-medium text-gray-700">Team 1 Score</label>
                                    <input type="number" id="score1" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                </div>
                                <div>
                                    <label id="score2-label" for="score2" class="block text-sm font-medium text-gray-700">Team 2 Score</label>
                                    <input type="number" id="score2" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                </div>
                            </div>

                            <div class="mb-4 flex items-center">
                                <input id="reset-match-checkbox" type="checkbox" class="h-4 w-4 text-red-600 border-gray-300 rounded">
                                <label for="reset-match-checkbox" class="ml-2 block text-sm text-red-700 font-medium">Reset Match (Set to Upcoming)</label>
                            </div>

                            <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">Save Score/Updates</button>
                        </form>
                    </div>

                    <div class="bg-white p-6 rounded-xl card-shadow border border-red-200">
                        <h3 class="text-2xl font-semibold text-red-700 mb-4">Data Management</h3>
                        <p class="text-gray-600 mb-4">Use this button to permanently delete all team and match data and re-initialize with default teams.</p>
                        <button id="reset-data-button" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none">‚ö†Ô∏è Reset ALL Data</button>
                    </div>
                </div>

            </div>
        </section>
        
    </main>
    
    <div id="message-modal" class="modal">
        <div class="modal-content text-center">
            <h4 class="text-xl font-bold mb-4 text-blue-700">Notification</h4>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <button id="modal-ok-button" class="py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150">OK</button>
        </div>
    </div>

    <div id="confirm-modal" class="modal">
        <div class="modal-content text-center">
            <h4 class="text-xl font-bold mb-4 text-red-700">Confirmation Required</h4>
            <p id="confirm-message" class="text-gray-700 mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-ok-button" class="py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-150">Confirm</button>
                <button id="confirm-cancel-button" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150">Cancel</button>
            </div>
        </div>
    </div>


<script>
// --- CONFIGURATION & FIREBASE INITIALIZATION ---

// üî¥ IMPORTANT: REPLACE THE FOLLOWING PLACEHOLDER CONFIG WITH YOUR REAL FIREBASE CONFIGURATION!
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};

let db;
let auth;
let appId = firebaseConfig.projectId; 
let teamsData = [];
let matchesData = [];
let adminAuthenticated = false;
let confirmCallback = null;

// ‚úÖ ÿßŸÑÿ™ÿπÿØŸäŸÑ 1: ÿ•ÿ≤ÿßŸÑÿ© ŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ (players) ŸÖŸÜ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
const defaultTeams = [
    { name: "9A", logo: "https://placehold.co/100x100/ADD8E6/000000?text=9A", captain: "ÿπŸÑŸä", points: 0, matchesPlayed: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, goalDifference: 0 },
    { name: "9B", logo: "https://placehold.co/100x100/F08080/000000?text=9B", captain: "ÿÆÿßŸÑÿØ", points: 0, matchesPlayed: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, goalDifference: 0 },
    { name: "9C", logo: "https://placehold.co/100x100/90EE90/000000?text=9C", captain: "ŸÖÿ±ŸàÿßŸÜ", points: 0, matchesPlayed: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, goalDifference: 0 },
    { name: "9D", logo: "https://placehold.co/100x100/ADD8E6/000000?text=9D", captain: "Ÿàÿßÿ≠ÿØ", points: 0, matchesPlayed: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, goalDifference: 0 },
    { name: "10A", logo: "https://placehold.co/100x100/5CAD48/000000?texxt=10A", captain: "ŸàŸÑŸäÿØ", points: 0, matchesPlayed: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, goalDifference: 0 },
];


async function initializeFirebase() {
    try {
        firebase.initializeApp(firebaseConfig); 
        db = firebase.firestore();
        auth = firebase.auth();
        
        auth.signInAnonymously().catch(error => {
            console.error("Error signing in anonymously:", error);
        });

        auth.onAuthStateChanged(user => {
            adminAuthenticated = user && user.email === 'admin@example.com'; 
            const adminSection = document.getElementById('admin-link');
            if (adminSection) adminSection.style.display = adminAuthenticated ? 'block' : 'none';

            if (user) {
                 checkAndCreateInitialData();
            }

            renderAllActiveSections();
        });
        
        await setupDataListeners();
    } catch (error) {
        console.error("Error initializing Firebase:", error);
    }
}

async function setupDataListeners() {
    const teamsCollectionRef = db.collection(`artifacts/${appId}/public/data/teams`);
    const matchesCollectionRef = db.collection(`artifacts/${appId}/public/data/matches`);

    teamsCollectionRef.onSnapshot(snapshot => {
        teamsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        calculateStandings(); 
        renderAllActiveSections();
    }, error => console.error("Teams data listener error:", error));

    matchesCollectionRef.onSnapshot(snapshot => {
        matchesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        calculateStandings(); 
        renderAllActiveSections();
    }, error => console.error("Matches data listener:", error));
}

// --- DATA INITIALIZATION & SECURITY (THE CORE FIX) ---
async function checkAndCreateInitialData() {
    try {
        const teamsCollectionRef = db.collection(`artifacts/${appId}/public/data/teams`);
        
        const configRef = db.doc(`artifacts/${appId}/public/data/config/setup`);
        const configSnapshot = await configRef.get();

        if (configSnapshot.exists && configSnapshot.data().initialized === true) {
            console.log("Default data already initialized (Config Flag found). Skipping.");
            return;
        }

        const teamsSnapshot = await teamsCollectionRef.get();
        if (teamsSnapshot.empty) {
            console.log("No teams found and config flag is missing. Initializing default data...");
            await initializeDefaultData(configRef); 
        } else {
            console.log("Teams found, but config flag is missing. Setting flag...");
            await configRef.set({ initialized: true });
        }
    } catch (error) {
        console.error("Error checking for initial data:", error);
    }
}

async function initializeDefaultData(configRef) {
    try {
        const teamsCollectionRef = db.collection(`artifacts/${appId}/public/data/teams`);
        const matchesCollectionRef = db.collection(`artifacts/${appId}/public/data/matches`);
        
        let teamNames = defaultTeams.map(t => t.name);
        const generatedMatches = generateRoundRobinSchedule(teamNames);

        let batch = db.batch();

        for (const team of defaultTeams) {
            const newTeamRef = teamsCollectionRef.doc();
            batch.set(newTeamRef, team);
        }
        
        // ‚úÖ ÿßŸÑÿ™ÿπÿØŸäŸÑ 2: ÿ•ÿ≤ÿßŸÑÿ© ÿ≠ŸÇŸÑ scorers ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        for (const match of generatedMatches) {
            const newMatchRef = matchesCollectionRef.doc();
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ≠ŸÇŸÑ scorers ŸÖŸÜ ŸÉÿßÿ¶ŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ŸÇÿ®ŸÑ ÿ•ÿ∂ÿßŸÅÿ™Ÿá ŸÑŸÑÿØŸÅÿπÿ©
            const { scorers, ...matchDataWithoutScorers } = match; 
            batch.set(newMatchRef, matchDataWithoutScorers);
        }
        
        batch.set(configRef, { initialized: true });

        await batch.commit();

        console.log("Default data (Teams, Matches, and Setup Flag) initialized successfully.");

    } catch (error) {
        console.error("Error initializing default data:", error);
    }
}
// --- DATABASE UPDATES ---
async function updateTeamStatsInFirestore(teamId, dataToUpdate) {
    try {
        const teamRef = db.collection(`artifacts/${appId}/public/data/teams`).doc(teamId);
        await teamRef.update(dataToUpdate);
    } catch (error) {
        console.error("Error updating team stats:", error);
        showModal("Failed to update team statistics. Error: " + error.message);
    }
}
async function updateMatchInFirestore(matchId, dataToUpdate) {
    try {
        const matchRef = db.collection(`artifacts/${appId}/public/data/matches`).doc(matchId);
        await matchRef.update(dataToUpdate);
    } catch (error) {
        console.error("Error updating match:", error);
        showModal("Failed to update match. Ensure you are logged in as an admin. Error: " + error.message);
    }
}

// --- UI & MODAL ---
function showModal(message) {
    document.getElementById('modal-message').textContent = message;
    document.getElementById('message-modal').style.display = 'flex';
}

function hideModal() {
    document.getElementById('message-modal').style.display = 'none';
}

function showConfirmModal(message, onConfirm) {
    document.getElementById('confirm-message').textContent = message;
    confirmCallback = onConfirm;
    document.getElementById('confirm-modal').style.display = 'flex';
}

function hideConfirmModal() {
    document.getElementById('confirm-modal').style.display = 'none';
    confirmCallback = null;
}

function openTeamModal(teamName) {
    showModal(`Displaying details for team: ${teamName}`);
    // Implement your actual team modal logic here
}


// --- LOGIC & CALCULATIONS ---
function formatDate_YYYYMMDD(dateString) {
    if (!dateString) return '';
    return dateString.replace(/-/g, '/');
}

function formatTimeForDisplay(time24) {
    if (!time24) return '';
    const [hours, minutes] = time24.split(':');
    const h = parseInt(hours, 10);
    const ampm = h >= 12 ? 'PM' : 'AM';
    const formattedHours = h % 12 || 12;
    return `${formattedHours.toString().padStart(2, '0')}:${minutes} ${ampm}`;
}

// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØÿßŸÑÿ© formatScorers

function generateRoundRobinSchedule(teamNames) {
    const teams = [...teamNames];
    if (teams.length % 2 !== 0) teams.push('BYE');  
    const numTeams = teams.length;
    const allMatches = [];
    let currentDate = new Date('2025-09-01T00:00:00');
    const times = ['09:00', '09:40']; // Use 24-hour format
    let timeIndex = 0;
    let matchesOnCurrentDay = 0;

    for (let round = 0; round < numTeams - 1; round++) {
        for (let i = 0; i < numTeams / 2; i++) {
            const team1 = teams[i];
            const team2 = teams[numTeams - 1 - i];

            if (team1 === 'BYE' || team2 === 'BYE') continue;

            while (currentDate.getDay() === 5 || currentDate.getDay() === 6) { // Skip Friday and Saturday
                currentDate.setDate(currentDate.getDate() + 1);
                timeIndex = 0;
                matchesOnCurrentDay = 0;
            }

            allMatches.push({
                team1,
                team2,
                date: currentDate.toISOString().slice(0, 10),
                time: times[timeIndex],
                location: "Main Stadium",
                status: "upcoming",
                score1: null, score2: null,
                // ‚úÖ ÿßŸÑÿ™ÿπÿØŸäŸÑ 3: ÿ≠ÿ∞ŸÅ ÿ≠ŸÇŸÑ scorers ŸÖŸÜ ŸÉÿßÿ¶ŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ©
                // scorers: { team1: [], team2: [] }, 
                round: round + 1
            });
            
            matchesOnCurrentDay++;
            if (matchesOnCurrentDay >= 2) { 
                matchesOnCurrentDay = 0;
                timeIndex = 0;
                currentDate.setDate(currentDate.getDate() + 1);
            } else {
                timeIndex++;
            }
        }
        teams.splice(1, 0, teams.pop());
    }
    return allMatches;
}

function updateTeamStats(teamName, opponentName, scoreTeam, scoreOpponent) {
    const team = teamsData.find(t => t.name === teamName);
    const opponent = teamsData.find(t => t.name === opponentName);
    if (!team || !opponent) return;

    team.matchesPlayed++;
    opponent.matchesPlayed++;
    team.goalsFor += scoreTeam;
    team.goalsAgainst += scoreOpponent;
    opponent.goalsFor += scoreOpponent;
    opponent.goalsAgainst += scoreTeam;

    if (scoreTeam > scoreOpponent) {
        team.wins++; team.points += 3; opponent.losses++;
    } else if (scoreTeam < scoreOpponent) {
        team.losses++; opponent.wins++; opponent.points += 3;
    } else {
        team.draws++; opponent.draws++; team.points += 1; opponent.points += 1;
    }
}

function calculateStandings() {
    teamsData.forEach(team => {
        team.matchesPlayed = 0; team.wins = 0; team.draws = 0; team.losses = 0;
        team.goalsFor = 0; team.goalsAgainst = 0; team.points = 0;
    });

    matchesData.forEach(match => {
        if (match.status === 'finished' && typeof match.score1 === 'number' && typeof match.score2 === 'number') {
            updateTeamStats(match.team1, match.team2, match.score1, match.score2);
        }
    });

    teamsData.forEach(team => {
        team.goalDifference = team.goalsFor - team.goalsAgainst;
    });
}
// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØÿßŸÑÿ© calculateTopScorers

// --- RENDER FUNCTIONS ---
function renderTeams() {
    const container = document.getElementById('teams-container');
    container.innerHTML = '';
    if (!teamsData || teamsData.length === 0) {
        container.innerHTML = `<p class="text-center text-gray-500 col-span-full">No teams.</p>`;
        return;
    }
    teamsData.forEach(team => {
        container.innerHTML += `
            <div class="bg-blue-50 rounded-xl card-shadow p-4 text-center border-2 border-blue-200">
                <img src="${team.logo || 'https://placehold.co/100x100/ccc/000?text=Logo'}" alt="${team.name} Logo" class="mx-auto mb-2 rounded-full border-4 border-blue-400 w-24 h-24 object-cover">
                <h3 class="text-2xl font-bold text-blue-800"><span class="hover:underline cursor-pointer" onclick="openTeamModal('${team.name}')">${team.name}</span></h3>
                <p class="text-lg text-gray-700">Captain: <span class="font-semibold">${team.captain}</span></p>
            </div>`;
    });
}

function renderMatches() {
    const upcomingContainer = document.getElementById('upcoming-matches');
    const pastContainer = document.getElementById('past-matches');
    const upcomingHeading = document.getElementById('upcoming-matches-heading');
    upcomingContainer.innerHTML = '';
    pastContainer.innerHTML = '';
    
    upcomingHeading.style.display = 'none'; 
    upcomingContainer.style.display = 'none'; 

    if (!matchesData) return;

    const upcomingMatches = matchesData.filter(m => m.status === 'upcoming').sort((a, b) => new Date(a.date) - new Date(b.date));
    const pastMatches = matchesData.filter(m => m.status === 'finished').sort((a, b) => new Date(b.date) - new Date(a.date));

    if (pastMatches.length === 0) {
        pastContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">No past matches.</p>`;
    } else {
        pastMatches.forEach(match => {
            const day = new Date(match.date).toLocaleDateString('en-US', { weekday: 'long' });
            
            // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ŸÇÿ≥ŸÖ ÿπÿ±ÿ∂ ÿßŸÑŸáÿØÿßŸÅŸäŸÜ ŸÖŸÜ ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ©
            pastContainer.innerHTML += `
                <div class="bg-red-50 rounded-xl card-shadow p-4 border-2 border-red-300">
                    <p class="text-sm text-gray-500 mb-2">${day}, ${formatDate_YYYYMMDD(match.date)}</p>
                    <p class="text-2xl font-bold text-center text-gray-800 mb-2">
                        <span class="hover:underline cursor-pointer" onclick="openTeamModal('${match.team1}')">${match.team1}</span>&nbsp;
                        <span class="text-red-600">${match.score1}-${match.score2}</span>&nbsp;
                        <span class="hover:underline cursor-pointer" onclick="openTeamModal('${match.team2}')">${match.team2}</span>
                    </p>
                    <p class="text-lg text-center text-red-700 font-semibold mb-3">Finished</p>
                </div>`;
        });
    }

    if (upcomingMatches.length === 0) {
        upcomingContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">No upcoming matches.</p>`;
    } else {
        upcomingMatches.forEach(match => {
            const day = new Date(match.date).toLocaleDateString('en-US', { weekday: 'long' });
            upcomingContainer.innerHTML += `
                <div class="bg-gray-50 rounded-xl card-shadow p-4 border-2 border-blue-300">
                    <p class="text-sm text-gray-500 mb-2">${day}, ${formatDate_YYYYMMDD(match.date)} - ${formatTimeForDisplay(match.time)}</p>
                    <p class="text-lg font-semibold text-gray-800">
                        <span class="hover:underline cursor-pointer" onclick="openTeamModal('${match.team1}')">${match.team1}</span>&nbsp;
                        <span class="text-blue-600 font-bold text-xl">VS</span>&nbsp;
                        <span class="hover:underline cursor-pointer" onclick="openTeamModal('${match.team2}')">${match.team2}</span>
                    </p>
                    <p class="text-lg text-center text-blue-500 font-semibold mb-2">Upcoming Match</p>
                    <p class="sm text-gray-600 text-center">Venue: ${match.location}</p>
                </div>`;
        });
    }
}


function renderStandings() {
    const tableBody = document.getElementById('standings-table-body');
    tableBody.innerHTML = '';
    if (!teamsData || teamsData.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-gray-500 py-4">No data available.</td></tr>`;
        return;
    }

    const sortedTeams = [...teamsData].sort((a, b) => {
        if (b.points !== a.points) return b.points - a.points;
        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
        return b.goalsFor - a.goalsFor;
    });

    sortedTeams.forEach((team, index) => {
        tableBody.innerHTML += `
            <tr class="hover:bg-gray-50">
                <td class="px-1 py-2 sm:px-6 sm:py-4 whitespace-nowrap">${index + 1}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4 whitespace-nowrap"><span class="text-blue-600 hover:underline cursor-pointer" onclick="openTeamModal('${team.name}')">${team.name}</span></td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.matchesPlayed}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.wins}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.draws}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.losses}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.goalsFor}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.goalsAgainst}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4">${team.goalDifference}</td>
                <td class="px-1 py-2 sm:px-6 sm:py-4 font-bold text-blue-800">${team.points}</td>
            </tr>`;
    });
}
// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØÿßŸÑÿ© renderTopScorers

function populateAdminMatchSelector() {
    const matchSelect = document.getElementById('match-select');
    const selectedValue = matchSelect.value;
    matchSelect.innerHTML = '<option value="">-- Select a Match --</option>';
    if (!matchesData) return;

    const sortedMatches = [...matchesData].sort((a, b) => new Date(a.date) - new Date(b.date));
    sortedMatches.forEach(match => {
        const statusText = match.status === 'upcoming' ? ' (Upcoming)' : ' (Finished)';
        const scoreText = match.status === 'finished' ? ` (${match.score1} - ${match.score2})` : '';
        matchSelect.innerHTML += `<option value="${match.id}">${match.team1} vs ${match.team2} (${formatDate_YYYYMMDD(match.date)})${scoreText}${statusText}</option>`;
    });
    matchSelect.value = selectedValue;
}
function handleMatchSelectionChange() {
    const selectedMatchId = document.getElementById('match-select').value;
    const score1Input = document.getElementById('score1');
    const score2Input = document.getElementById('score2');
    const score1Label = document.getElementById('score1-label');
    const score2Label = document.getElementById('score2-label');
    const dateInput = document.getElementById('match-date');
    const timeInput = document.getElementById('match-time');
    const dateTimeContainer = document.getElementById('date-time-inputs');

    if (selectedMatchId) {
        const selectedMatch = matchesData.find(m => m.id == selectedMatchId);
        if (selectedMatch) {
            dateTimeContainer.style.display = 'grid';
            score1Label.textContent = `Score ${selectedMatch.team1}`;
            score2Label.textContent = `Score ${selectedMatch.team2}`;
            score1Input.value = selectedMatch.status === 'finished' ? selectedMatch.score1 ?? '' : '';
            score2Input.value = selectedMatch.status === 'finished' ? selectedMatch.score2 ?? '' : '';
            dateInput.value = selectedMatch.date || '';
            timeInput.value = selectedMatch.time || '';
        }
    } else {
        dateTimeContainer.style.display = 'none';
        score1Label.textContent = 'Team 1 Score';
        score2Label.textContent = 'Team 2 Score';
        score1Input.value = '';
        score2Input.value = '';
        dateInput.value = '';
        timeInput.value = '';
    }
    // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßÿ≥ÿ™ÿØÿπÿßÿ° updateScorersSection
}

// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØÿßŸÑÿ© updateScorersSection
// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØÿßŸÑÿ© renderScorerInputs


function renderAllActiveSections() {
    const activeSection = document.querySelector('.page-section.active');
    const sectionId = activeSection ? activeSection.id : 'home'; 

    document.querySelectorAll('.nav-button').forEach(button => button.classList.remove('active'));
    const activeButton = document.querySelector(`.nav-button[data-target="${sectionId}"]`);
    if (activeButton) activeButton.classList.add('active');

    if (sectionId === 'teams') renderTeams();
    else if (sectionId === 'matches') renderMatches();
    else if (sectionId === 'standings') {
        calculateStandings();
        renderStandings();
    } 
    // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ¥ÿ±ÿ∑ (else if (sectionId === 'scorers')
    else if (sectionId === 'admin' && adminAuthenticated) {
        populateAdminMatchSelector();
        handleMatchSelectionChange();
    }
}

function showSection(sectionId) {
    document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');

    if (sectionId === 'admin') {
        if (adminAuthenticated) {
            document.getElementById('admin-password-prompt').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            populateAdminMatchSelector();
            handleMatchSelectionChange();
        } else {
            document.getElementById('admin-password-prompt').style.display = 'block';
            document.getElementById('admin-content').style.display = 'none';
        }
    } else {
        renderAllActiveSections();
    }
    document.querySelectorAll('.nav-button').forEach(button => button.classList.remove('active'));
    const activeButton = document.querySelector(`.nav-button[data-target="${sectionId}"]`);
    if (activeButton) activeButton.classList.add('active');
}

// --- EVENT LISTENERS ---
document.querySelectorAll('.nav-button[data-target]').forEach(button => {
    button.addEventListener('click', (e) => showSection(e.currentTarget.dataset.target));
});

document.getElementById('admin-login-button').addEventListener('click', async () => {
    const email = document.getElementById('admin-email').value;
    const password = document.getElementById('admin-password').value;
    const errorMsg = document.getElementById('admin-password-error');
    errorMsg.style.display = 'none';

    if (!email || !password) {
        errorMsg.textContent = "Please enter email and password.";
        errorMsg.style.display = 'block';
        return;
    }
    try {
        await auth.signInWithEmailAndPassword(email, password);
        showModal('Logged in successfully as admin!');
        showSection('admin');
    } catch (error) {
        errorMsg.textContent = 'Incorrect email or password.';
        errorMsg.style.display = 'block';
    }
});

document.getElementById('admin-logout-button').addEventListener('click', () => {
    auth.signOut().then(() => {
        showModal('Logged out successfully.');
        showSection('home');
    }).catch((error) => console.error('Sign out error', error));
});

document.getElementById('update-score-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const matchId = document.getElementById('match-select').value;
    if (!matchId) {
        showModal('Please select a match.');
        return;
    }
    const score1Input = document.getElementById('score1');
    const score2Input = document.getElementById('score2');
    const dateInput = document.getElementById('match-date');
    const timeInput = document.getElementById('match-time');
    const resetMatchCheckbox = document.getElementById('reset-match-checkbox');
    
    let dataToUpdate = {
        date: dateInput.value,
        time: timeInput.value
    };

    if (resetMatchCheckbox.checked) {
        dataToUpdate.status = 'upcoming';
        dataToUpdate.score1 = null;
        dataToUpdate.score2 = null;
        // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ≠ŸÇŸÑ scorers
    } else {
        const newScore1 = parseInt(score1Input.value, 10);
        const newScore2 = parseInt(score2Input.value, 10);
        
        if (!isNaN(newScore1) && !isNaN(newScore2)) {
            
            // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØÿØ ÿßŸÑŸáÿØÿßŸÅŸäŸÜ Ÿàÿ™ÿ¨ŸÖŸäÿπŸáŸÖ
            
            dataToUpdate.status = 'finished';
            dataToUpdate.score1 = newScore1;
            dataToUpdate.score2 = newScore2;
            // ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ≠ŸÇŸÑ scorers
        } else if (score1Input.value || score2Input.value) {
            showModal('Please enter a valid numeric score for both teams to record the result.');
            return;
        }
    }

    await updateMatchInFirestore(matchId, dataToUpdate);
    document.getElementById('update-score-form').reset();
    handleMatchSelectionChange();
    showModal('Match updated successfully!');
});
document.getElementById('match-select').addEventListener('change', handleMatchSelectionChange);
// ‚ùå ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ŸÖÿ≥ÿ™ŸÖÿπÿßÿ™ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™ ŸÑŸÄ score1 Ÿà score2


document.getElementById('close-modal-button').addEventListener('click', hideModal);
document.getElementById('modal-ok-button').addEventListener('click', hideModal);
window.addEventListener('click', (event) => {
    if (event.target === document.getElementById('message-modal')) {
        hideModal();
    }
});

document.getElementById('confirm-ok-button').addEventListener('click', () => {
    if (confirmCallback) {
        confirmCallback();
    }
    hideConfirmModal();
});

document.getElementById('confirm-cancel-button').addEventListener('click', hideConfirmModal);

document.getElementById('reset-data-button').addEventListener('click', () => {
    showConfirmModal(
        'Are you sure you want to reset the data? All current teams and matches will be permanently deleted.',
        async () => {
            showModal("Resetting data...");
            try {
                const matchesCollectionRef = db.collection(`artifacts/${appId}/public/data/matches`);
                const matchesSnapshot = await matchesCollectionRef.get();
                for (const doc of matchesSnapshot.docs) {
                    await doc.ref.delete();
                }
                console.log("All matches deleted.");

                const teamsCollectionRef = db.collection(`artifacts/${appId}/public/data/teams`);
                const teamsSnapshot = await teamsCollectionRef.get();
                for (const doc of teamsSnapshot.docs) {
                    await doc.ref.delete();
                }
                console.log("All teams deleted.");
                
                const configRef = db.doc(`artifacts/${appId}/public/data/config/setup`);
                await configRef.delete();
                console.log("Setup flag deleted.");

                await initializeDefaultData(configRef); 
                showModal('Data has been reset and re-initialized successfully!');
            } catch (error) {
                console.error("Error resetting data:", error);
                showModal('An error occurred while resetting data: ' + error.message);
            }
        }
    );
});

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', initializeFirebase);

</script>
</body>
</html>
